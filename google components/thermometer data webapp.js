{"files":[{"id":"d3409679-7486-49b8-8ba3-b670d3d1b238","name":"Code","type":"server_js","source":"\n\n// global vars\n var spreadsheet\u003dSpreadsheetApp.openById(\"1LJJyrZIYCjeUJ_x5o9MZyoiQaQL2RQgNiDag9Go385s\");\n var output \u003d [];\n var outputString \u003d \u0027no output\u0027;\n\nfunction doGet(e){\n  //define vars\n  //check for sheet parameter and deal with consequences\n  if(e.parameter[\u0027sheet\u0027]){\n    newSheet(e.parameter[\u0027sheet\u0027]);\n  }\n  else{\n    spreadsheet.getSheetByName(\u0027Sheet1\u0027).activate()\n  }\n  \n  //post data \n  delete e.parameter[\u0027sheet\u0027]\n  addData(e.parameter)\n  \n//do the thing that makes stuff come up when you send \nreturn ContentService.createTextOutput(\"sheet added\"+ e.parameter[\u0027sheet\u0027]);\n}\n\nfunction newSheet(sheetName){\n  if(!spreadsheet.getSheetByName(sheetName)){\n  spreadsheet.insertSheet(sheetName)\n  spreadsheet.getSheetByName(sheetName).getRange(1, 1).setValue(\"Timestamp\")\n  spreadsheet.getSheetByName(sheetName).activate()\n  }\n  else {\n  spreadsheet.getSheetByName(sheetName).activate()\n  }\n  \n}\n\n\nfunction addTest(){\n  var testObject \u003d {\n    \"another\":\"smoval\",\n     //\"new\":\"val\"\n  }\n  \n  for(key in testObject){\n    Logger.log(key+\", \"+testObject[key])\n  }\n  \naddData(testObject)\n}\n\n\nfunction addData(someObject){\n  var currentdate \u003d new Date(); \n  var timeStamp \u003d currentdate.getHours() + \":\"  \n                + currentdate.getMinutes() + \":\" \n                + currentdate.getSeconds();   // from http://stackoverflow.com/a/10211214/6287001\n  Logger.log(timeStamp)\n  var addColumn \u003d 0;\n  var keyPairNumber \u003d 0;\n  var sheet \u003d spreadsheet.getActiveSheet();\n  var lastColumn \u003d sheet.getLastColumn();  //remember these are floats\n  var lastRow \u003d sheet.getLastRow();\n  var sheetValues \u003d sheet.getSheetValues(1,1,1,parseInt(lastColumn)) // get the values for the first line where the headers will be\n  \n  for(key in someObject){\n   var header \u003d key;\n   var data \u003d someObject[key];\n    \n    keyPairNumber+\u003d1;\n    Logger.log(\"kpnum is\" + keyPairNumber)\n    \n  for(i\u003d0; i\u003c lastColumn;i++){ // this for loop checks through headers to find correct column, then adds data after last row\n    if(sheetValues[0][i] \u003d\u003d header){\n      addColumn\u003di;\n    }\n    else{Logger.log(\"header doesn\u0027t exist yet\")}\n  }\n  \n  if(addColumn){ //sheetValues[0][i] \u003d\u003d testVal\n    lastRowInColumn \u003d sheet.getRange(parseInt(lastRow),i+1).getLastRow();\n    range \u003d sheet.getRange(lastRowInColumn+1,addColumn+1);\n    timeRange \u003d sheet.getRange(lastRowInColumn+1, 1);\n    range.setValue(data) // this is the value that gets added, probably change to e.parameters[testVal]\n    Logger.log(\"added data to existing header\")\n    timeRange.setValue(timeStamp);\n  }\n  else{ //if header not found\n    //set header\n    headerColumn \u003d lastColumn+keyPairNumber;\n    range \u003d sheet.getRange(1,headerColumn);\n    range.setValue(header);\n    Logger.log(\"added new header and data\")\n    //set data\n    lastRowInColumn \u003d sheet.getRange(parseInt(lastRow),headerColumn).getLastRow();\n    range \u003d sheet.getRange(lastRowInColumn+1,headerColumn);\n    timeRange \u003d sheet.getRange(lastRowInColumn+1, 1)\n    range.setValue(data);\n    timeRange.setValue(timeStamp);\n  }\n}\n}\n"}]}